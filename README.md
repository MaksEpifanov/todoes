# ETodo - React Native CLI todo list

## Технологии

- TypeScript, ReactNative CLI
- React, Redux Toolkit, Redux saga
- React Native Web, React Navigation, React Native async storage
- UI Kitten, Styled components, MomentJS
- ESlint, Prettier, eslint-config-airbnb

## Описание

- Используется React Native CLI. Попытался максимум все типизировать.
- Выбрал Redux Toolkit, но при необходимости и с vanilla Redux без проблем могу работать.
- Тестировал: Web(Chrome, Firefox), Emulator(Pixel 4), OnePlus 7.
- OS: Arch Linux

### Сделано

- [x] Приложение позволяет добавлять/удалять/редактировать задачи. У каждой задачи есть: заголовок, флаг выполнена или нет, дата начала, дата конца и описание. Даты выводиться в формате "5 фев 2022 г.";

- [x] Задачи отображаются на главной странице в порядке их добавления в виде
      списка с пагинацией. По достижению конца страницы добавляются новые данные, а по достижению конца списка задач отображается надпись “Конец
      списка”. На одной странице отображаются 15 задач;

- [x] Задачи на главной странице можно фильтровать по всем параметрам, кроме
      описания. После изменения параметров фильтрации пагинация сбрасывается.

- [x] Добавление и редактирование происходит на отдельной странице.

- [x] Удаление задачи происходит на главном экране после подтверждения, вызывается модальное окно;

- [x] Флаг “Выполнена” у задачи можно изменить только на главной странице;

- [x] Все данные о задачах сохраняются в LocalStorage и загружаются оттуда при
      открытии приложения;

- [x] Все страницы сверстаны на flex. Верстка адаптирована только под мобильные устройства;

- [x] Удаленные задачи отображаться на отдельной странице “Корзина”. Список удаленных задач можно очистить;

- [x] На всех страницах отображается информация о состоянии синхронизации с LocalStorage, задержка синхронизации в 500мс;

- [x] Данные синхронизируются с LocalStorage раз в 5с;

- [x] Ошибка синхронизации (происходит в 50% случаях), появляется надпись "Ошибка" c кнопкой (возможность перезапустить синхронизацию);

## Особенности

- Работа с Todo

  - Для страниц использовал React Navigation, вложенные роуты (Tabs + Stack).
  - Основное меню Tabs, при клике на кнопку изменить задачу, происходит переход на отдельную страницу, где подгружаются все задачи и ищется нужная.
  - Добавление/изменение задач используют Input, Datepicker(UI kitten)
  - Даты хранятся в стейте в виде timestamp, форматируются с помощью moment
  - Удаление задачи происходит помещением в корзину(вызывается action addItemToShredder), после реагирует сага и удаляет данную задача из данных.

- Пагинация

  - Используется FlatList (пробовал VirtualizedList, но в renderItem не проходят данные). По достижению конца страницы добавляются новые данные, но имеется задержка.
  - Используется отдельный slice для пагинации. По достижению конца страницы происходит увеличение текущей страницы на 1, перерасчет данных поступающих в FlatList
  - Когда происходит action(updateTodos) срабатывает сага для пересчета максимальной страницы.

- Фильтрация

  - Каждое изменение в компонентах фильтра (Input, Datepicker) вызывает свой action для изменения соответствующего поля в стейте
  - При нажатии кнопки "Отфильтровать" вызывает action onFilter "включающий фильтрацию", после срабатывает сага (вытягивает, фильтрует и добавляет отфильтрованные данные в отдельное поле), после чего в FlatList поступают отфильтрованные данные, пагинация отключается
  - При нажатии на "Сброс" вызывает action clearFilter, происходит сброс всех полей фильтра и "выключение" фильтра.
  - Поле Input (для заголовка) использует эффект debounce для избежания частых срабатываний dispatch.

- Синхронизация

  - При любой манипуляции с задачей происходить запись данных в localStorage (используется react native async storage).
  - При открытии происходит загрузка c LS. Раз в 5 секунд происходит синхронизация с LS.
  - Логика написана в компоненте navigation. При первом открытии срабатывает useEffect(вызывает ф-ция getInitTodosFromLS, диспатч данных), после срабатывает другой useEffect, вызывающий ф-цию setLoadingDataFromLS раз в 5с (если успешно, то диспатч данных, если нет, то изменение локального стейта).
  - Логика имитации задержки и появления ошибка находится в хуке useLocalStorage. Создается Promise, возвращает через 500мс resolve или reject, зависит от random переменной.

### Баги

- Задержка при достижении конца списка, при обратной прокрутке пагинация не меняется

### Изучил

- Принципы работы с React Native, React Navigation, взаимодействия с Styled Components
- Подключение и тестирование на разных устройствах.
- Принцип работы с moment
- Работа с ошибками ))
